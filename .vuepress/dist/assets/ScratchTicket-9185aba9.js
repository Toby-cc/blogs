import{_ as M,b as y,o as x,p as D,q as b,t as I,a5 as T,S as L,s as l,w as v,J as C,n as H}from"./framework-2dd55860.js";const W={class:"container",id:"container"},B=["src"],S={__name:"ScratchTicket",props:{topImg:{type:String,default:"https://toby607-1317049696.cos.ap-guangzhou.myqcloud.com/images/blogs/wallhaven-yxeww7.jpg"},baseImg:{type:String,default:"https://toby607-1317049696.cos.ap-guangzhou.myqcloud.com/images/blogs/wallhaven-yxeww7.jpg"}},setup(u){const r=u,t=y({isMouseDown:!1,lastLoc:{x:0,y:0},curLoc:{x:0,y:0},canvasWidth:0,canvasHeight:0,threshold:.65});let a;x(()=>{let n=document.getElementById("container").getBoundingClientRect().width;const o=new Image;o.crossOrigin="anonymous",o.src=r.baseImg,o.onload=function(){t.canvasWidth=n,t.canvasHeight=n/(o.width/o.height),h()}});const h=()=>{const e=document.getElementById("canvas");e.width=t.canvasWidth,e.height=t.canvasHeight,a=e.getContext("2d"),m(r.topImg)},m=e=>{const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=function(){a.drawImage(n,0,0,t.canvasWidth,t.canvasHeight)}},p=e=>{e.preventDefault(),t.isMouseDown=!0,t.lastLoc=s(e.clientX,e.clientY)},f=e=>{e.preventDefault(),t.isMouseDown=!0;const n=e.touches[0];t.lastLoc=s(n.clientX,n.clientY)},w=e=>{e.preventDefault(),t.isMouseDown&&(t.curLoc=s(e.clientX,e.clientY),a.save(),a.beginPath(),a.arc(t.curLoc.x,t.curLoc.y,20,0,Math.PI*2,!1),a.clip(),a.clearRect(0,0,t.canvasWidth,t.canvasHeight),a.restore())},_=e=>{if(e.preventDefault(),t.isMouseDown){const n=e.touches[0];t.curLoc=s(n.clientX,n.clientY),a.save(),a.beginPath(),a.arc(t.curLoc.x,t.curLoc.y,20,0,Math.PI*2,!1),a.clip(),a.clearRect(0,0,t.canvasWidth,t.canvasHeight),a.restore()}},d=e=>{e.preventDefault(),t.isMouseDown=!1;const o=a.getImageData(0,0,t.canvasWidth,t.canvasHeight).data;let c=0;for(let i=0;i<o.length;i+=4)o[i+3]===0&&c++;c/(t.canvasWidth*t.canvasHeight)>t.threshold&&a.clearRect(0,0,t.canvasWidth,t.canvasHeight)},g=e=>{e.preventDefault(),t.isMouseDown&&(t.isMouseDown=!1)},s=(e,n)=>{const c=document.getElementById("canvas").getBoundingClientRect();return{x:Math.round(e-c.left),y:Math.round(n-c.top)}};return(e,n)=>{const o=H("el-button");return D(),b(C,null,[I(o,{round:"",onClick:n[0]||(n[0]=c=>h()),style:{"margin-bottom":"20px"}},{default:T(()=>[L("重置")]),_:1}),l("div",W,[v(" 顶部图片 "),l("canvas",{id:"canvas",onMousedown:p,onMousemove:w,onMouseup:d,onMouseout:g,onTouchstart:f,onTouchmove:_,onTouchend:d,onTouchcancel:g},null,32),v(" 底部图片 "),l("img",{src:u.baseImg},null,8,B)])],64)}}},R=M(S,[["__scopeId","data-v-9b32a0c9"],["__file","ScratchTicket.vue"]]);export{R as default};
