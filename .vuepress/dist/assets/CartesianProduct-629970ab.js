import{_ as ie,b as T,r as V,z as de,o as ce,p as g,q as h,w,s as c,aq as y,t as s,a5 as i,J as E,K as P,M as N,I as S,S as x,u as D,n as f}from"./framework-2dd55860.js";import{E as L,a as F}from"./app-8089f5c9.js";const pe={style:{display:"flex"}},me=c("span",null,"属性信息",-1),_e={style:{"margin-left":"10px",cursor:"pointer"}},fe={class:"collapse_title"},be={class:"collapse_title--name"},ge=["onClick"],he={class:"collapse_content"},ve={class:"EditPen",style:{"margin-left":"5px"}},Ve=["onClick"],we=["onClick"],Ce={class:"collapse_content--add"},ke=["onClick"],ye={class:"dialog-footer"},Ee=c("h4",null,"属性列表",-1),xe={style:{"margin-top":"50px"}},$e=c("h4",null,"属性栏",-1),Ue={class:"name"},Pe={__name:"CartesianProduct",setup(Se){const d=T([{name:"颜色",id:1001,list:["红色","蓝色","绿色"]},{name:"尺码",id:1002,list:["S","M","L"]},{name:"材质",id:1003,list:["棉质","涤纶"]}]);let p=T([]);const M=V(!1),j=V(null),K=V(null),C=V(1),$=V(10),b=T({attributeName:"",attributeValue:""}),G=T({attributeName:[{required:!0,message:"请输入属性名",trigger:"blur"},{min:1,max:10,message:"请输入1-10个字符",trigger:"blur"}],attributeValue:[{required:!0,message:"请输入属性值",trigger:"blur"},{min:1,max:10,message:"请输入1-10个字符",trigger:"blur"}]}),U=V({1001:"",1002:"",1003:""}),A=V(1001);de(d,(r,e)=>{let l=d.map(n=>n.id).reduce((n,t)=>(n[t]="",n),{});U.value={...l}});const z=r=>{const e=r.map(t=>t.list.map(o=>({name:t.name,id:t.id,val:o}))),l=[],n=(t=[],o)=>{for(let u=0;u<e[o].length;u++)o<e.length-1?(t[o]=e[o][u],n(t,o+1)):l.push([...t,e[o][u]]);return l};return n([],0)},q=r=>r.map((e,l)=>{const n={};return e.forEach(({id:t,val:o})=>{n[t]=o}),{id:new Date().getTime()+""+l,attributes:e,attributesValue:n,SKU:e.map(t=>t.val).join(),stock:Math.floor(Math.random()*6),price:100}}),H=(r,e)=>{const l={...U.value,[r]:e};for(const n of p){let t=!0;for(const[o,u]of Object.entries(l))if(u&&n.attributesValue[o]!==u){t=!1;break}if(t&&n.stock>0)return!0}return!1},Q=r=>{F.prompt("","修改属性名称",{confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,inputPattern:/^.{0,10}$/,inputErrorMessage:"最多输入10个字符",inputValue:r}).then(({value:e})=>{if(e===r)return;d.forEach(t=>{t.name===r&&(t.name=e)});const l=z(d),n=l.map(t=>t.map(o=>o.val).join());p.forEach(({SKU:t},o)=>{const u=n.findIndex(m=>m===t);u!==-1&&(p[o].attributes=l[u])})}).catch(()=>{})},W=(r,e,l,n)=>{F.prompt("",`修改${r}属性值`,{confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,inputPattern:/^.{0,10}$/,inputErrorMessage:"最多输入10个字符",inputValue:e}).then(({value:t})=>{if(d[l].list.includes(t))L({showClose:!0,message:"已有重复属性值",type:"warning"});else{const o=d[l].id;p.forEach(u=>{u.attributes.forEach(m=>{m.id===o&&m.val===e&&(m.val=t,u.SKU=u.attributes.map(B=>B.val).join())}),u.attributesValue[o]===e&&(u.attributesValue[o]=t)}),d[l].list[n]=t}}).catch(()=>{})},X=r=>{if(d.length===1)return L({showClose:!0,message:"无法删除最后一项属性",type:"warning"});const e=d[r].id;p.forEach(l=>{const n=l.attributes.findIndex(t=>t.id===e);if(n!==-1){l.attributes.splice(n,1);let t=Object.keys(l.attributesValue);const o=t.findIndex(m=>m===e.toString());delete l.attributesValue[t[o]];const u=l.attributes.map(m=>m.val).join();l.SKU=u}}),d.splice(r,1)},Y=(r,e)=>{const l=d[r].list[e],n=p.filter(t=>{for(let o=0;o<t.attributes.length;o++)if(t.attributes[o].val===l)return!1;return!0});p.length=0,p.push(...n),d[r].list.splice(e,1)},Z=(r,e)=>{F.prompt("",`添加${r}属性值`,{confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,inputPattern:/^.{0,10}$/,inputErrorMessage:"最多输入10个字符",inputValue:""}).then(({value:l})=>{const n=d.map((u,m)=>m===e?{name:u.name,id:u.id,list:[l]}:u),t=z(n),o=q(t);p.length=0,p.push(...p,...o),d[e].list.push(l)}).catch(()=>{})},ee=()=>{j.value.validate(r=>{if(r){if(d.map(n=>n.name).includes(b.attributeName)){L({showClose:!0,message:"属性名已存在",type:"warning"});return}const l=Math.floor(Math.random()*9e3)+1e3;d.push({name:b.attributeName,id:l,list:[b.attributeValue]}),p.forEach(n=>{n.attributes.push({name:b.attributeName,id:l,val:b.attributeValue}),n.attributesValue[l]=b.attributeValue,n.SKU=n.attributes.map(t=>t.val).join()}),I()}})},I=()=>{j.value.resetFields(),M.value=!1},O=(r,e,l)=>{!e&&e!==0?l(new Error("参数不能为空")):l()},te=r=>{p.splice(r,1)},le=()=>{setTimeout(()=>{K.value.resetFields()},100)};return ce(()=>{const r=z(d);p.push(...q(r))}),(r,e)=>{const l=f("SvgIcon"),n=f("el-link"),t=f("el-collapse-item"),o=f("el-collapse"),u=f("el-input"),m=f("el-form-item"),B=f("el-form"),R=f("el-button"),ae=f("el-dialog"),k=f("el-table-column"),ne=f("el-table"),oe=f("el-pagination"),se=f("el-radio-button"),re=f("el-radio-group");return g(),h(E,null,[w(" 属性信息 "),c("div",null,[c("h4",pe,[me,c("div",_e,[c("span",{onClick:e[0]||(e[0]=y(a=>M.value=!0,["stop"]))},[s(l,{name:"ele-Plus",color:"#5D67E8",size:18})])])]),s(o,{modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=a=>A.value=a),class:"collapse"},{default:i(()=>[(g(!0),h(E,null,P(d,(a,_)=>(g(),N(t,{name:a.id,key:a.id},{title:i(()=>[w(" collapse标题 "),c("div",fe,[c("div",be,[c("span",null,S(a.name),1),w(" 图标 "),c("div",{class:"EditPen",onClick:y(v=>Q(a.name),["stop"])},[s(l,{name:"ele-EditPen",color:"#5D67E8",size:18})],8,ge)]),s(n,{type:"danger",underline:!1,onClick:y(v=>X(_),["stop"])},{default:i(()=>[x("删除")]),_:2},1032,["onClick"])])]),default:i(()=>[(g(!0),h(E,null,P(a.list,(v,J)=>(g(),h("div",he,[c("span",null,S(v),1),w(" 图标 "),c("div",ve,[c("span",{onClick:y(ue=>W(a.name,v,_,J),["stop"])},[s(l,{name:"ele-EditPen",color:"#5D67E8",size:18})],8,Ve),c("span",{onClick:y(ue=>Y(_,J),["stop"])},[s(l,{name:"ele-Delete",color:"#5D67E8",size:18})],8,we)])]))),256)),c("div",Ce,[c("span",{onClick:y(v=>Z(a.name,_),["stop"])},[s(l,{name:"ele-Plus",color:"#5D67E8",size:18})],8,ke)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),w(" 添加属性项的弹窗 "),s(ae,{modelValue:M.value,"onUpdate:modelValue":e[5]||(e[5]=a=>M.value=a),title:"添加属性",width:"400px","before-close":I},{footer:i(()=>[c("span",ye,[s(R,{onClick:I},{default:i(()=>[x("取消")]),_:1}),s(R,{type:"primary",onClick:e[4]||(e[4]=a=>ee())},{default:i(()=>[x(" 确定 ")]),_:1})])]),default:i(()=>[s(B,{ref_key:"ruleFormRef",ref:j,model:b,rules:G,"label-width":"80px"},{default:i(()=>[s(m,{label:"属性名",prop:"attributeName"},{default:i(()=>[s(u,{modelValue:b.attributeName,"onUpdate:modelValue":e[2]||(e[2]=a=>b.attributeName=a)},null,8,["modelValue"])]),_:1}),s(m,{label:"属性值",prop:"attributeValue"},{default:i(()=>[s(u,{modelValue:b.attributeValue,"onUpdate:modelValue":e[3]||(e[3]=a=>b.attributeValue=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),w(" 属性列表 "),s(B,{class:"table",ref_key:"ruleTable",ref:K,model:D(p),"label-width":"0"},{default:i(()=>[Ee,s(ne,{data:D(p).slice((C.value-1)*$.value,C.value*$.value),style:{width:"100%"},"table-layout":"fixed"},{default:i(()=>[s(k,{label:"属性信息",align:"center",width:"200"},{default:i(()=>[(g(!0),h(E,null,P(d,(a,_)=>(g(),N(k,{key:_,label:a.name,align:"center"},{default:i(v=>[x(S(v.row.attributesValue[a.id]),1)]),_:2},1032,["label"]))),128))]),_:1}),s(k,{prop:"SKU",label:"SKU",align:"center",width:"200"}),s(k,{label:"售价",align:"center",width:"200"},{default:i(a=>[s(m,{prop:`[${a.$index+$.value*(C.value-1)}].price`,rules:[{trigger:"blur",validator:O}]},{default:i(()=>[s(u,{type:"number",modelValue:a.row.price,"onUpdate:modelValue":_=>a.row.price=_,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),s(k,{label:"库存",align:"center",width:"200"},{default:i(a=>[s(m,{prop:`[${a.$index+$.value*(C.value-1)}].stock`,rules:[{trigger:"blur",validator:O}]},{default:i(()=>[s(u,{type:"number",modelValue:a.row.stock,"onUpdate:modelValue":_=>a.row.stock=_,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),s(k,{label:"操作",align:"center",width:"80"},{default:i(a=>[s(n,{type:"danger",onClick:_=>te(a.$index)},{default:i(()=>[x("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),s(oe,{small:"",background:"","page-size":$.value,onCurrentChange:le,"current-page":C.value,"onUpdate:currentPage":e[6]||(e[6]=a=>C.value=a),layout:"prev, pager, next",total:D(p).length,class:"pagination"},null,8,["page-size","current-page","total"])]),_:1},8,["model"]),w(" 属性栏 "),c("div",xe,[$e,(g(!0),h(E,null,P(d,a=>(g(),h("div",{class:"ab_Combining",key:a.id},[c("div",Ue,S(a.name)+":",1),s(re,{modelValue:U.value[a.id],"onUpdate:modelValue":_=>U.value[a.id]=_,size:"large"},{default:i(()=>[(g(!0),h(E,null,P(a.list,_=>(g(),N(se,{label:_,disabled:!H(a.id,_)},null,8,["label","disabled"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),x(" 您选择的是： "+S(U.value),1)])],64)}}},Te=ie(Pe,[["__file","CartesianProduct.vue"]]);export{Te as default};
