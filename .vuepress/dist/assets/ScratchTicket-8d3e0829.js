import{_ as M,b as y,o as x,p as D,q as I,t as T,a5 as b,S as L,s as l,w as g,J as C,n as H}from"./framework-2dd55860.js";const W={class:"container",id:"container"},k=["src"],B={__name:"ScratchTicket",props:{topImg:{type:String,default:"https://w.wallhaven.cc/full/yx/wallhaven-yxeww7.jpg"},baseImg:{type:String,default:"https://w.wallhaven.cc/full/zy/wallhaven-zygeko.jpg"}},setup(u){const r=u,e=y({isMouseDown:!1,lastLoc:{x:0,y:0},curLoc:{x:0,y:0},canvasWidth:0,canvasHeight:0,threshold:.65});let a;x(()=>{let n=document.getElementById("container").getBoundingClientRect().width;const o=new Image;o.crossOrigin="anonymous",o.src=r.baseImg,o.onload=function(){e.canvasWidth=n,e.canvasHeight=n/(o.width/o.height),d()}});const d=()=>{const t=document.getElementById("canvas");t.width=e.canvasWidth,t.height=e.canvasHeight,a=t.getContext("2d"),m(r.topImg)},m=t=>{const n=new Image;n.crossOrigin="anonymous",n.src=t,n.onload=function(){a.drawImage(n,0,0,e.canvasWidth,e.canvasHeight)}},p=t=>{t.preventDefault(),e.isMouseDown=!0,e.lastLoc=s(t.clientX,t.clientY)},f=t=>{t.preventDefault(),e.isMouseDown=!0;const n=t.touches[0];e.lastLoc=s(n.clientX,n.clientY)},w=t=>{t.preventDefault(),e.isMouseDown&&(e.curLoc=s(t.clientX,t.clientY),a.save(),a.beginPath(),a.arc(e.curLoc.x,e.curLoc.y,20,0,Math.PI*2,!1),a.clip(),a.clearRect(0,0,e.canvasWidth,e.canvasHeight),a.restore())},_=t=>{if(t.preventDefault(),e.isMouseDown){const n=t.touches[0];e.curLoc=s(n.clientX,n.clientY),a.save(),a.beginPath(),a.arc(e.curLoc.x,e.curLoc.y,20,0,Math.PI*2,!1),a.clip(),a.clearRect(0,0,e.canvasWidth,e.canvasHeight),a.restore()}},h=t=>{t.preventDefault(),e.isMouseDown=!1;const o=a.getImageData(0,0,e.canvasWidth,e.canvasHeight).data;let c=0;for(let i=0;i<o.length;i+=4)o[i+3]===0&&c++;c/(e.canvasWidth*e.canvasHeight)>e.threshold&&a.clearRect(0,0,e.canvasWidth,e.canvasHeight)},v=t=>{t.preventDefault(),e.isMouseDown&&(e.isMouseDown=!1)},s=(t,n)=>{const c=document.getElementById("canvas").getBoundingClientRect();return{x:Math.round(t-c.left),y:Math.round(n-c.top)}};return(t,n)=>{const o=H("el-button");return D(),I(C,null,[T(o,{round:"",onClick:n[0]||(n[0]=c=>d()),style:{"margin-bottom":"20px"}},{default:b(()=>[L("重置")]),_:1}),l("div",W,[g(" 顶部图片 "),l("canvas",{id:"canvas",onMousedown:p,onMousemove:w,onMouseup:h,onMouseout:v,onTouchstart:f,onTouchmove:_,onTouchend:h,onTouchcancel:v},null,32),g(" 底部图片 "),l("img",{src:u.baseImg},null,8,k)])],64)}}},R=M(B,[["__scopeId","data-v-0d3d0890"],["__file","ScratchTicket.vue"]]);export{R as default};
