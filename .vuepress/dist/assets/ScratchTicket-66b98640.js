import{w as v}from"./app-a14aa263.js";import{_ as D,b as x,o as y,p as I,q as b,t as T,a5 as L,S as B,s as l,w as m,u as C,J as H,n as W}from"./framework-2dd55860.js";const k={class:"container",id:"container"},S=["src"],E={__name:"ScratchTicket",props:{topImg:{type:String,default:"/images/images_blogs_wallhaven-yxeww7.jpg"},baseImg:{type:String,default:"/images/images_blogs_wallhaven-zygeko.jpg"}},setup(r){const u=r,e=x({isMouseDown:!1,lastLoc:{x:0,y:0},curLoc:{x:0,y:0},canvasWidth:0,canvasHeight:0,threshold:.65});let a;y(()=>{let n=document.getElementById("container").getBoundingClientRect().width;const o=new Image;o.crossOrigin="anonymous",o.src=u.baseImg,o.onload=function(){e.canvasWidth=n,e.canvasHeight=n/(o.width/o.height),d()}});const d=()=>{const t=document.getElementById("canvas");t.width=e.canvasWidth,t.height=e.canvasHeight,a=t.getContext("2d"),p(v(u.topImg))},p=t=>{const n=new Image;n.crossOrigin="anonymous",n.src=t,n.onload=function(){a.drawImage(n,0,0,e.canvasWidth,e.canvasHeight)}},f=t=>{t.preventDefault(),e.isMouseDown=!0,e.lastLoc=c(t.clientX,t.clientY)},_=t=>{t.preventDefault(),e.isMouseDown=!0;const n=t.touches[0];e.lastLoc=c(n.clientX,n.clientY)},w=t=>{t.preventDefault(),e.isMouseDown&&(e.curLoc=c(t.clientX,t.clientY),a.save(),a.beginPath(),a.arc(e.curLoc.x,e.curLoc.y,20,0,Math.PI*2,!1),a.clip(),a.clearRect(0,0,e.canvasWidth,e.canvasHeight),a.restore())},M=t=>{if(t.preventDefault(),e.isMouseDown){const n=t.touches[0];e.curLoc=c(n.clientX,n.clientY),a.save(),a.beginPath(),a.arc(e.curLoc.x,e.curLoc.y,20,0,Math.PI*2,!1),a.clip(),a.clearRect(0,0,e.canvasWidth,e.canvasHeight),a.restore()}},h=t=>{t.preventDefault(),e.isMouseDown=!1;const o=a.getImageData(0,0,e.canvasWidth,e.canvasHeight).data;let s=0;for(let i=0;i<o.length;i+=4)o[i+3]===0&&s++;s/(e.canvasWidth*e.canvasHeight)>e.threshold&&a.clearRect(0,0,e.canvasWidth,e.canvasHeight)},g=t=>{t.preventDefault(),e.isMouseDown&&(e.isMouseDown=!1)},c=(t,n)=>{const s=document.getElementById("canvas").getBoundingClientRect();return{x:Math.round(t-s.left),y:Math.round(n-s.top)}};return(t,n)=>{const o=W("el-button");return I(),b(H,null,[T(o,{round:"",onClick:n[0]||(n[0]=s=>d()),style:{"margin-bottom":"20px"}},{default:L(()=>[B("重置")]),_:1}),l("div",k,[m(" 顶部图片 "),l("canvas",{id:"canvas",onMousedown:f,onMousemove:w,onMouseup:h,onMouseout:g,onTouchstart:_,onTouchmove:M,onTouchend:h,onTouchcancel:g},null,32),m(" 底部图片 "),l("img",{src:C(v)(r.baseImg)},null,8,S)])],64)}}},V=D(E,[["__scopeId","data-v-0d832ed4"],["__file","ScratchTicket.vue"]]);export{V as default};
