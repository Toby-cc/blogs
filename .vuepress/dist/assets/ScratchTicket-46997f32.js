import{w as l}from"./app-85a22d9c.js";import{_ as D,b as x,o as y,p as b,q as I,t as T,a5 as L,S as B,s as r,w as m,u as C,J as H,n as W}from"./framework-2dd55860.js";const k={class:"container",id:"container"},S=["src"],E={__name:"ScratchTicket",props:{topImg:{type:String,default:"/images/images_blogs_wallhaven-yxeww7.jpg"},baseImg:{type:String,default:"/images/images_blogs_wallhaven-zygeko.jpg"}},setup(u){const d=u,e=x({isMouseDown:!1,lastLoc:{x:0,y:0},curLoc:{x:0,y:0},canvasWidth:0,canvasHeight:0,threshold:.65});let n;y(()=>{let a=document.getElementById("container").getBoundingClientRect().width;const o=new Image;o.crossOrigin="anonymous",o.src=l(d.baseImg),o.onload=function(){e.canvasWidth=a,e.canvasHeight=a/(o.width/o.height),h()}});const h=()=>{const t=document.getElementById("canvas");t.width=e.canvasWidth,t.height=e.canvasHeight,n=t.getContext("2d"),p(l(d.topImg))},p=t=>{const a=new Image;a.crossOrigin="anonymous",a.src=t,a.onload=function(){n.drawImage(a,0,0,e.canvasWidth,e.canvasHeight)}},f=t=>{t.preventDefault(),e.isMouseDown=!0,e.lastLoc=s(t.clientX,t.clientY)},_=t=>{t.preventDefault(),e.isMouseDown=!0;const a=t.touches[0];e.lastLoc=s(a.clientX,a.clientY)},w=t=>{t.preventDefault(),e.isMouseDown&&(e.curLoc=s(t.clientX,t.clientY),n.save(),n.beginPath(),n.arc(e.curLoc.x,e.curLoc.y,20,0,Math.PI*2,!1),n.clip(),n.clearRect(0,0,e.canvasWidth,e.canvasHeight),n.restore())},M=t=>{if(t.preventDefault(),e.isMouseDown){const a=t.touches[0];e.curLoc=s(a.clientX,a.clientY),n.save(),n.beginPath(),n.arc(e.curLoc.x,e.curLoc.y,20,0,Math.PI*2,!1),n.clip(),n.clearRect(0,0,e.canvasWidth,e.canvasHeight),n.restore()}},g=t=>{t.preventDefault(),e.isMouseDown=!1;const o=n.getImageData(0,0,e.canvasWidth,e.canvasHeight).data;let c=0;for(let i=0;i<o.length;i+=4)o[i+3]===0&&c++;c/(e.canvasWidth*e.canvasHeight)>e.threshold&&n.clearRect(0,0,e.canvasWidth,e.canvasHeight)},v=t=>{t.preventDefault(),e.isMouseDown&&(e.isMouseDown=!1)},s=(t,a)=>{const c=document.getElementById("canvas").getBoundingClientRect();return{x:Math.round(t-c.left),y:Math.round(a-c.top)}};return(t,a)=>{const o=W("el-button");return b(),I(H,null,[T(o,{round:"",onClick:a[0]||(a[0]=c=>h()),style:{"margin-bottom":"20px"}},{default:L(()=>[B("重置")]),_:1}),r("div",k,[m(" 顶部图片 "),r("canvas",{id:"canvas",onMousedown:f,onMousemove:w,onMouseup:g,onMouseout:v,onTouchstart:_,onTouchmove:M,onTouchend:g,onTouchcancel:v},null,32),m(" 底部图片 "),r("img",{src:C(l)(u.baseImg)},null,8,S)])],64)}}},V=D(E,[["__scopeId","data-v-9c1adabf"],["__file","ScratchTicket.vue"]]);export{V as default};
