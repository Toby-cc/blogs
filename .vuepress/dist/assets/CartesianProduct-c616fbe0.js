import{_ as ue,b as T,r as V,z as ie,o as de,p as g,q as v,w,s as c,ar as y,t as r,a5 as d,J as k,K as P,M as N,I as $,S as M,u as D,n as f}from"./framework-0cc1c2cc.js";import{E as F,a as K}from"./app-27cb0ff0.js";const ce={style:{display:"flex"}},pe=c("span",null,"属性信息",-1),me={style:{"margin-left":"10px",cursor:"pointer"}},_e={class:"collapse_title"},fe={class:"collapse_title--name"},be=["onClick"],ge={class:"collapse_content"},ve={class:"EditPen",style:{"margin-left":"5px"}},he=["onClick"],Ve=["onClick"],we={class:"collapse_content--add"},Ce=["onClick"],ye={class:"dialog-footer"},ke=c("h4",null,"属性列表",-1),Ee={style:{"margin-top":"50px"}},xe={class:"name"},Ue={__name:"CartesianProduct",setup(Pe){const i=T([{name:"颜色",id:1001,list:["红色","蓝色","绿色"]},{name:"尺码",id:1002,list:["S","M","L"]},{name:"材质",id:1003,list:["棉质","涤纶"]}]);let p=T([]);const S=V(!1),j=V(null),L=V(null),C=V(1),E=V(10),b=T({attributeName:"",attributeValue:""}),G=T({attributeName:[{required:!0,message:"请输入属性名",trigger:"blur"},{min:1,max:10,message:"请输入1-10个字符",trigger:"blur"}],attributeValue:[{required:!0,message:"请输入属性值",trigger:"blur"},{min:1,max:10,message:"请输入1-10个字符",trigger:"blur"}]}),x=V({1001:"",1002:"",1003:""}),A=V(1001);ie(i,(u,e)=>{let l=i.map(n=>n.id).reduce((n,t)=>(n[t]="",n),{});x.value={...l}});const z=u=>{const e=u.map(t=>t.list.map(o=>({name:t.name,id:t.id,val:o}))),l=[],n=(t=[],o)=>{for(let s=0;s<e[o].length;s++)o<e.length-1?(t[o]=e[o][s],n(t,o+1)):l.push([...t,e[o][s]]);return l};return n([],0)},q=u=>u.map((e,l)=>{const n={};return e.forEach(({id:t,val:o})=>{n[t]=o}),{id:new Date().getTime()+""+l,attributes:e,attributesValue:n,SKU:e.map(t=>t.val).join(),stock:Math.floor(Math.random()*6),price:100}}),H=(u,e)=>{const l={...x.value,[u]:e};for(const n of p){let t=!0;for(const[o,s]of Object.entries(l))if(s&&n.attributesValue[o]!==s){t=!1;break}if(t&&n.stock>0)return!0}return!1},Q=u=>{K.prompt("","修改属性名称",{confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,inputPattern:/^.{0,10}$/,inputErrorMessage:"最多输入10个字符",inputValue:u}).then(({value:e})=>{if(e===u)return;i.forEach(t=>{t.name===u&&(t.name=e)});const l=z(i),n=l.map(t=>t.map(o=>o.val).join());p.forEach(({SKU:t},o)=>{const s=n.findIndex(m=>m===t);s!==-1&&(p[o].attributes=l[s])})}).catch(()=>{})},W=(u,e,l,n)=>{K.prompt("",`修改${u}属性值`,{confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,inputPattern:/^.{0,10}$/,inputErrorMessage:"最多输入10个字符",inputValue:e}).then(({value:t})=>{if(i[l].list.includes(t))F({showClose:!0,message:"已有重复属性值",type:"warning"});else{const o=i[l].id;p.forEach(s=>{s.attributes.forEach(m=>{m.id===o&&m.val===e&&(m.val=t,s.SKU=s.attributes.map(B=>B.val).join())}),s.attributesValue[o]===e&&(s.attributesValue[o]=t)}),i[l].list[n]=t}}).catch(()=>{})},X=u=>{if(i.length===1)return F({showClose:!0,message:"无法删除最后一项属性",type:"warning"});const e=i[u].id;p.forEach(l=>{const n=l.attributes.findIndex(t=>t.id===e);if(n!==-1){l.attributes.splice(n,1);let t=Object.keys(l.attributesValue);const o=t.findIndex(m=>m===e.toString());delete l.attributesValue[t[o]];const s=l.attributes.map(m=>m.val).join();l.SKU=s}}),i.splice(u,1)},Y=(u,e)=>{const l=i[u].list[e],n=p.filter(t=>{for(let o=0;o<t.attributes.length;o++)if(t.attributes[o].val===l)return!1;return!0});p.length=0,p.push(...n),i[u].list.splice(e,1)},Z=(u,e)=>{K.prompt("",`添加${u}属性值`,{confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,inputPattern:/^.{0,10}$/,inputErrorMessage:"最多输入10个字符",inputValue:""}).then(({value:l})=>{const n=i.map((s,m)=>m===e?{name:s.name,id:s.id,list:[l]}:s),t=z(n),o=q(t);p.length=0,p.push(...p,...o),i[e].list.push(l)}).catch(()=>{})},ee=()=>{j.value.validate(u=>{if(u){if(i.map(n=>n.name).includes(b.attributeName)){F({showClose:!0,message:"属性名已存在",type:"warning"});return}const l=Math.floor(Math.random()*9e3)+1e3;i.push({name:b.attributeName,id:l,list:[b.attributeValue]}),p.forEach(n=>{n.attributes.push({name:b.attributeName,id:l,val:b.attributeValue}),n.attributesValue[l]=b.attributeValue,n.SKU=n.attributes.map(t=>t.val).join()}),I()}})},I=()=>{j.value.resetFields(),S.value=!1},O=(u,e,l)=>{console.log("value: ",e),!e&&e!==0?l(new Error("参数不能为空")):l()},te=()=>{setTimeout(()=>{L.value.resetFields()},100)};return de(()=>{const u=z(i);p.push(...q(u))}),(u,e)=>{const l=f("SvgIcon"),n=f("el-link"),t=f("el-collapse-item"),o=f("el-collapse"),s=f("el-input"),m=f("el-form-item"),B=f("el-form"),R=f("el-button"),le=f("el-dialog"),U=f("el-table-column"),ae=f("el-table"),ne=f("el-pagination"),oe=f("el-radio-button"),se=f("el-radio-group");return g(),v(k,null,[w(" 属性信息 "),c("div",null,[c("h4",ce,[pe,c("div",me,[c("span",{onClick:e[0]||(e[0]=y(a=>S.value=!0,["stop"]))},[r(l,{name:"ele-Plus",color:"#5D67E8",size:18})])])]),r(o,{modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=a=>A.value=a),class:"collapse"},{default:d(()=>[(g(!0),v(k,null,P(i,(a,_)=>(g(),N(t,{name:a.id,key:a.id},{title:d(()=>[w(" collapse标题 "),c("div",_e,[c("div",fe,[c("span",null,$(a.name),1),w(" 图标 "),c("div",{class:"EditPen",onClick:y(h=>Q(a.name),["stop"])},[r(l,{name:"ele-EditPen",color:"#5D67E8",size:18})],8,be)]),r(n,{type:"danger",underline:!1,onClick:y(h=>X(_),["stop"])},{default:d(()=>[M("删除")]),_:2},1032,["onClick"])])]),default:d(()=>[(g(!0),v(k,null,P(a.list,(h,J)=>(g(),v("div",ge,[c("span",null,$(h),1),w(" 图标 "),c("div",ve,[c("span",{onClick:y(re=>W(a.name,h,_,J),["stop"])},[r(l,{name:"ele-EditPen",color:"#5D67E8",size:18})],8,he),c("span",{onClick:y(re=>Y(_,J),["stop"])},[r(l,{name:"ele-Delete",color:"#5D67E8",size:18})],8,Ve)])]))),256)),c("div",we,[c("span",{onClick:y(h=>Z(a.name,_),["stop"])},[r(l,{name:"ele-Plus",color:"#5D67E8",size:18})],8,Ce)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),w(" 添加属性项的弹窗 "),r(le,{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=a=>S.value=a),title:"添加属性",width:"400px","before-close":I},{footer:d(()=>[c("span",ye,[r(R,{onClick:I},{default:d(()=>[M("取消")]),_:1}),r(R,{type:"primary",onClick:e[4]||(e[4]=a=>ee())},{default:d(()=>[M(" 确定 ")]),_:1})])]),default:d(()=>[r(B,{ref_key:"ruleFormRef",ref:j,model:b,rules:G,"label-width":"80px"},{default:d(()=>[r(m,{label:"属性名",prop:"attributeName"},{default:d(()=>[r(s,{modelValue:b.attributeName,"onUpdate:modelValue":e[2]||(e[2]=a=>b.attributeName=a)},null,8,["modelValue"])]),_:1}),r(m,{label:"属性值",prop:"attributeValue"},{default:d(()=>[r(s,{modelValue:b.attributeValue,"onUpdate:modelValue":e[3]||(e[3]=a=>b.attributeValue=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),w(" 属性列表 "),r(B,{class:"table",ref_key:"ruleTable",ref:L,model:D(p),"label-width":"0"},{default:d(()=>[ke,r(ae,{data:D(p).slice((C.value-1)*E.value,C.value*E.value),style:{width:"100%"},"table-layout":"fixed"},{default:d(()=>[r(U,{label:"属性信息",align:"center",width:"200"},{default:d(()=>[(g(!0),v(k,null,P(i,(a,_)=>(g(),N(U,{key:_,label:a.name,align:"center"},{default:d(h=>[M($(h.row.attributesValue[a.id]),1)]),_:2},1032,["label"]))),128))]),_:1}),r(U,{prop:"SKU",label:"SKU",align:"center",width:"200"}),r(U,{label:"售价",align:"center",width:"200"},{default:d(a=>[r(m,{prop:`[${a.$index+E.value*(C.value-1)}].price`,rules:[{trigger:"blur",validator:O}]},{default:d(()=>[r(s,{type:"number",modelValue:a.row.price,"onUpdate:modelValue":_=>a.row.price=_,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),r(U,{label:"库存",align:"center",width:"200"},{default:d(a=>[r(m,{prop:`[${a.$index+E.value*(C.value-1)}].stock`,rules:[{trigger:"blur",validator:O}]},{default:d(()=>[r(s,{type:"number",modelValue:a.row.stock,"onUpdate:modelValue":_=>a.row.stock=_,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"]),r(ne,{small:"",background:"","page-size":E.value,onCurrentChange:te,"current-page":C.value,"onUpdate:currentPage":e[6]||(e[6]=a=>C.value=a),layout:"prev, pager, next",total:D(p).length,class:"pagination"},null,8,["page-size","current-page","total"])]),_:1},8,["model"]),w(" 属性栏 "),c("div",Ee,[(g(!0),v(k,null,P(i,a=>(g(),v("div",{class:"ab_Combining",key:a.id},[c("div",xe,$(a.name)+":",1),r(se,{modelValue:x.value[a.id],"onUpdate:modelValue":_=>x.value[a.id]=_,size:"large"},{default:d(()=>[(g(!0),v(k,null,P(a.list,_=>(g(),N(oe,{label:_,disabled:!H(a.id,_)},null,8,["label","disabled"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),M(" 您选择的是： "+$(x.value),1)])],64)}}},Se=ue(Ue,[["__file","CartesianProduct.vue"]]);export{Se as default};
